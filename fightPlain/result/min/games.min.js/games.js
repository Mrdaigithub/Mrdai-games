"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var s=e[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,a,s){return a&&t(e.prototype,a),s&&t(e,s),e}}();!function(t,e){var a=t,s=e,n=null,i=a.getElementById("canvas"),d=i.getContext("2d"),y=a.getElementById("startBtn"),h=a.getElementById("aboutBtn"),u=a.getElementById("welcome"),o=a.getElementById("pause"),l=a.getElementById("standings"),m=!0,r=null;i.width=a.body.clientWidth,i.height=a.body.clientHeight,s.onresize=function(){i.width=a.body.clientWidth,i.height=a.body.clientHeight},h.addEventListener("touchstart",function(){alert("Mrdai 倾情制作~")},!1),o.addEventListener("touchend",function(){m?(o.style.backgroundImage='url("img/Fav_Voice_Play-hd.png")',m=!1):(o.style.backgroundImage='url("img/Fav_Voice_Pause-hd.png")',m=!0)},!1);var p=function(){function t(e,a){var i=this;_classCallCheck(this,t),this.canvas=e,this.ctx=a,this.allScore=0,this.gameStatus=!1,this.gravityMode=!1,this.img=new Image,this.img.src="../img/gameArts.png",this.bg={speed:2,ready:!1,bg1:{x:0,y:0},bg2:{x:0,y:-568}},this.player={x:this.canvas.width/2,y:this.canvas.height-88,normalPos:[{x:432,y:332},{x:432,y:0}],diePos:[{x:432,y:250},{x:432,y:85},{x:432,y:168}],sX:null,sY:null,count:0,dieCount:0,dieStatus:!1,animationTime:200,animation:function(){i.player.dieStatus?setTimeout(function(){switch(n.player.dieCount){case 0:n.player.sX=n.player.diePos[0].x,n.player.sY=n.player.diePos[0].y,n.player.dieCount++;break;case 1:n.player.sX=n.player.diePos[1].x,n.player.sY=n.player.diePos[1].y,n.player.dieCount++;break;case 2:n.player.sX=n.player.diePos[2].x,n.player.sY=n.player.diePos[2].y,n.player.dieCount++;break;case 3:s.cancelAnimationFrame(r),n.player.dieCount++;break;default:l.style.display="block"}n.player.animation()},n.player.animationTime):setTimeout(function(){1===n.player.count?(n.player.count=0,n.player.sX=n.player.normalPos[0].x,n.player.sY=n.player.normalPos[0].y):(n.player.sX=n.player.normalPos[1].x,n.player.sY=n.player.normalPos[1].y,n.player.count++),n.player.animation()},n.player.animationTime)}},this.pos={x:this.canvas.width/2,y:this.canvas.height-33},this.bullet={speed:15,interval:100,power:10,dataPound:[{x:this.player.x,y:this.player.y,status:!1},{x:this.player.x,y:this.player.y,status:!1},{x:this.player.x,y:this.player.y,status:!1},{x:this.player.x,y:this.player.y,status:!1},{x:this.player.x,y:this.player.y,status:!1},{x:this.player.x,y:this.player.y,status:!1},{x:this.player.x,y:this.player.y,status:!1},{x:this.player.x,y:this.player.y,status:!1},{x:this.player.x,y:this.player.y,status:!1},{x:this.player.x,y:this.player.y,status:!1},{x:this.player.x,y:this.player.y,status:!1},{x:this.player.x,y:this.player.y,status:!1},{x:this.player.x,y:this.player.y,status:!1}],useBullet:function(){for(var t=0;t<this.dataPound.length;t++)if(!this.dataPound[t].status)return this.dataPound[t].status=!0,this.dataPound[t].x=n.player.x+33,setTimeout(function(){n.bullet.useBullet()},n.bullet.interval),this.dataPound[t]},moveBullet:function(){for(var t=0;t<this.dataPound.length;t++)this.dataPound[t].status&&(this.dataPound[t].y-=this.speed)},resetBullet:function(t){return this.dataPound[t].status=!1,this.dataPound[t].y=n.player.y,this.dataPound[t]}},this.enemy={animationTime:200,simpleEnemy:{speed:1,score:100,dataPound:[{x:Math.random()*this.canvas.width+20,y:-2,sX:82,sY:658,hp:50,displayStatus:!1,dieStatus:!1},{x:Math.random()*this.canvas.width+20,y:-2,sX:82,sY:658,hp:50,displayStatus:!1,dieStatus:!1},{x:Math.random()*this.canvas.width+20,y:-2,sX:82,sY:658,hp:50,displayStatus:!1,dieStatus:!1},{x:Math.random()*this.canvas.width+20,y:-2,sX:82,sY:658,hp:50,displayStatus:!1,dieStatus:!1},{x:Math.random()*this.canvas.width+20,y:-2,sX:82,sY:658,hp:50,displayStatus:!1,dieStatus:!1},{x:Math.random()*this.canvas.width+20,y:-2,sX:82,sY:658,hp:50,displayStatus:!1,dieStatus:!1},{x:Math.random()*this.canvas.width+20,y:-2,sX:82,sY:658,hp:50,displayStatus:!1,dieStatus:!1},{x:Math.random()*this.canvas.width+20,y:-2,sX:82,sY:658,hp:50,displayStatus:!1,dieStatus:!1},{x:Math.random()*this.canvas.width+20,y:-2,sX:82,sY:658,hp:50,displayStatus:!1,dieStatus:!1}],diePos:[{x:50,y:658},{x:420,y:734},{x:475,y:723}],dieCount:0},middleEnemy:{speed:3,hp:100,score:200,dataPound:[{x:Math.random()*this.canvas.width,y:-60,sX:0,sY:570,hp:100,displayStatus:!1,dieStatus:!1},{x:Math.random()*this.canvas.width,y:-60,sX:0,sY:570,hp:100,displayStatus:!1,dieStatus:!1},{x:Math.random()*this.canvas.width,y:-60,sX:0,sY:570,hp:100,displayStatus:!1,dieStatus:!1},{x:Math.random()*this.canvas.width,y:-60,sX:0,sY:570,hp:100,displayStatus:!1,dieStatus:!1},{x:Math.random()*this.canvas.width,y:-60,sX:0,sY:570,hp:100,displayStatus:!1,dieStatus:!1},{x:Math.random()*this.canvas.width,y:-60,sX:0,sY:570,hp:100,displayStatus:!1,dieStatus:!1},{x:Math.random()*this.canvas.width,y:-60,sX:0,sY:570,hp:100,displayStatus:!1,dieStatus:!1},{x:Math.random()*this.canvas.width,y:-60,sX:0,sY:570,hp:100,displayStatus:!1,dieStatus:!1},{x:Math.random()*this.canvas.width,y:-60,sX:0,sY:570,hp:100,displayStatus:!1,dieStatus:!1}],diePos:[{x:430,y:540},{x:430,y:600},{x:430,y:480}],dieCount:0},hardEnemy:{speed:1,hp:500,score:500,dataPound:[{x:Math.random()*this.canvas.width,y:-165,sX:220,sY:850,hp:300,dieCount:0,displayStatus:!1,dieStatus:!1},{x:Math.random()*this.canvas.width,y:-165,sX:220,sY:850,hp:300,dieCount:0,displayStatus:!1,dieStatus:!1},{x:Math.random()*this.canvas.width,y:-165,sX:220,sY:850,hp:300,dieCount:0,displayStatus:!1,dieStatus:!1},{x:Math.random()*this.canvas.width,y:-165,sX:220,sY:850,hp:300,dieCount:0,displayStatus:!1,dieStatus:!1},{x:Math.random()*this.canvas.width,y:-165,sX:220,sY:850,hp:300,dieCount:0,displayStatus:!1,dieStatus:!1},{x:Math.random()*this.canvas.width,y:-165,sX:220,sY:850,hp:300,dieCount:0,displayStatus:!1,dieStatus:!1},{x:Math.random()*this.canvas.width,y:-165,sX:220,sY:850,hp:300,dieCount:0,displayStatus:!1,dieStatus:!1},{x:Math.random()*this.canvas.width,y:-165,sX:220,sY:850,hp:300,dieCount:0,displayStatus:!1,dieStatus:!1},{x:Math.random()*this.canvas.width,y:-165,sX:220,sY:850,hp:300,dieCount:0,displayStatus:!1,dieStatus:!1}],diePos:[{x:0,y:750},{x:320,y:340},{x:320,y:0}],dieCount:0},animation:function(t,e){var a="simpleEnemy";switch(e){case 0:a="simpleEnemy";break;case 1:a="middleEnemy";break;case 2:a="hardEnemy"}setTimeout(function(){switch(n.enemy[a].dataPound[t].dieCount){case 0:n.enemy[a].dataPound[t].dieStatus=!1,n.enemy[a].dataPound[t].sX=n.enemy[a].diePos[0].x,n.enemy[a].dataPound[t].sY=n.enemy[a].diePos[0].y,n.enemy[a].dataPound[t].dieCount++;break;case 1:n.enemy[a].dataPound[t].sX=n.enemy[a].diePos[1].x,n.enemy[a].dataPound[t].sY=n.enemy[a].diePos[1].y,n.enemy[a].dataPound[t].dieCount++;break;case 2:n.enemy[a].dataPound[t].sX=n.enemy[a].diePos[2].x,n.enemy[a].dataPound[t].sY=n.enemy[a].diePos[2].y,n.enemy[a].dataPound[t].dieCount++;break;default:return n.enemy.resetEnemy(t,e),0}n.enemy.animation(t,e)},n.enemy.animationTime)},createEnemy:function(){var t,e=Math.floor(10*Math.random());if(0===e||1===e||2===e||3===e||4===e||5===e||6===e||7===e||8===e||9===e){for(var t=0;t<i.enemy.middleEnemy.dataPound.length;t++)if(!i.enemy.middleEnemy.dataPound[t].displayStatus){i.enemy.middleEnemy.dataPound[t].displayStatus=!0,i.enemy.middleEnemy.dataPound[t].dieStatus=!0;break}}else var t;setTimeout(function(){n.enemy.createEnemy()},1e3)},moveEnemy:function(){for(var t=0;t<i.enemy.simpleEnemy.dataPound.length;t++)i.enemy.simpleEnemy.dataPound[t].dieStatus&&(i.enemy.simpleEnemy.dataPound[t].y+=i.enemy.simpleEnemy.speed);for(var t=0;t<i.enemy.middleEnemy.dataPound.length;t++)i.enemy.middleEnemy.dataPound[t].dieStatus&&(i.enemy.middleEnemy.dataPound[t].y+=i.enemy.middleEnemy.speed);for(var t=0;t<i.enemy.hardEnemy.dataPound.length;t++)i.enemy.hardEnemy.dataPound[t].dieStatus&&(i.enemy.hardEnemy.dataPound[t].y+=i.enemy.hardEnemy.speed)},resetEnemy:function(t,e){var a=null;switch(e){case 0:a="simpleEnemy",i.enemy[a].dataPound[t].x=Math.random()*i.canvas.width,i.enemy[a].dataPound[t].y=-20,i.enemy[a].dataPound[t].sX=82,i.enemy[a].dataPound[t].sY=658,i.enemy[a].dataPound[t].hp=50;break;case 1:a="middleEnemy",i.enemy[a].dataPound[t].x=Math.random()*i.canvas.width,i.enemy[a].dataPound[t].y=-60,i.enemy[a].dataPound[t].sX=0,i.enemy[a].dataPound[t].sY=570,i.enemy[a].dataPound[t].hp=150;break;case 2:a="hardEnemy",i.enemy[a].dataPound[t].x=Math.random()*i.canvas.width,i.enemy[a].dataPound[t].y=-165,i.enemy[a].dataPound[t].sX=220,i.enemy[a].dataPound[t].sY=850,i.enemy[a].dataPound[t].hp=300}i.enemy[a].dataPound[t].dieCount=0,i.enemy[a].dataPound[t].dieStatus=!1,i.enemy[a].dataPound[t].displayStatus=!1}},n=this}return _createClass(t,[{key:"processUserInput",value:function(){var t=this;this.gravityMode||addEventListener("touchmove",function(e){var a=s.event||e;t.pos.x=a.targetTouches[0].clientX,t.pos.y=a.targetTouches[0].clientY,t.pos.x<32&&(t.pos.x=32),t.pos.y<55&&(t.pos.y=55),t.pos.x>t.canvas.width-32&&(t.pos.x=t.canvas.width-32),t.pos.y>t.canvas.height-25&&(t.pos.y=t.canvas.height-25)},!1)}},{key:"loadImg",value:function(){var t=this;this.img.onload=function(){return t.bg.ready=!0}}},{key:"isPlayerDie",value:function(){for(var t=0;t<this.enemy.middleEnemy.dataPound.length;t++)if(this.enemy.middleEnemy.dataPound[t].dieStatus&&this.player.x<=this.enemy.middleEnemy.dataPound[t].x+45&&this.player.x+64>=this.enemy.middleEnemy.dataPound[t].x&&this.player.y<=this.enemy.middleEnemy.dataPound[t].y+57&&this.player.y+80>=this.enemy.middleEnemy.dataPound[t].y)return!0;return!1}},{key:"isEnemyDie",value:function(){for(var t={count:null,maxPosY:1e4},e={bool:!1,count:null,levelEnemy:null},a=0;a<this.bullet.dataPound.length;a++)this.bullet.dataPound[a].status&&this.bullet.dataPound[a].y<t.maxPosY&&(t.maxPosY=this.bullet.dataPound[a].y,t.count=a);for(var a=0;a<this.enemy.middleEnemy.dataPound.length;a++)if(this.enemy.middleEnemy.dataPound[a].dieStatus&&this.bullet.dataPound[t.count].x+7>this.enemy.middleEnemy.dataPound[a].x&&this.bullet.dataPound[t.count].x<this.enemy.middleEnemy.dataPound[a].x+30&&this.bullet.dataPound[t.count].y<this.enemy.middleEnemy.dataPound[a].y+22)return console.log(0),this.bullet.resetBullet(t.count),e.bool=!0,e.count=a,e.levelEnemy="middleEnemy",e;return e}},{key:"update",value:function(){this.bg.bg1.y>=568&&(this.bg.bg1.y=-568),this.bg.bg2.y>=568&&(this.bg.bg2.y=-568),this.bg.bg1.y+=this.bg.speed,this.bg.bg2.y+=this.bg.speed,this.player.x=this.pos.x-33,this.player.y=this.pos.y-55,this.isPlayerDie()&&(this.player.dieStatus=!0,this.player.animation()),this.bullet.moveBullet(),this.enemy.moveEnemy();var t=this.isEnemyDie();if(t.bool&&(this.enemy[t.levelEnemy].dataPound[t.count].hp-=this.bullet.power,this.enemy[t.levelEnemy].dataPound[t.count].hp<=0)){this.allScore+=this.enemy[t.levelEnemy].score,this.enemy[t.levelEnemy].dataPound[t.count].dieStatus=!1;var e=null;switch(t.levelEnemy){case"simpleEnemy":e=0;break;case"middleEnemy":e=1;break;case"hardEnemy":e=2}this.enemy.animation(t.count,e)}}},{key:"render",value:function(){if(this.bg.ready){this.ctx.drawImage(this.img,0,0,320,568,this.bg.bg1.x,this.bg.bg1.y,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.img,0,0,320,568,this.bg.bg2.x,this.bg.bg2.y,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.img,this.player.sX,this.player.sY,64,80,this.player.x,this.player.y,64,80);for(var t=0;t<this.bullet.dataPound.length;t++)this.bullet.dataPound[t].status&&(this.bullet.dataPound[t].y<=0?this.bullet.resetBullet(t):this.ctx.drawImage(this.img,0,730,10,10,this.bullet.dataPound[t].x,this.bullet.dataPound[t].y,7,12));for(var t=0;t<this.enemy.middleEnemy.dataPound.length;t++)this.enemy.middleEnemy.dataPound[t].displayStatus&&(this.enemy.middleEnemy.dataPound[t].y>this.canvas.height?this.enemy.resetEnemy(t,1):this.ctx.drawImage(this.img,this.enemy.middleEnemy.dataPound[t].sX,this.enemy.middleEnemy.dataPound[t].sY,45,57,this.enemy.middleEnemy.dataPound[t].x,this.enemy.middleEnemy.dataPound[t].y,45,57));this.ctx.fillStyle="rgb(250, 250, 250)",this.ctx.font="20px Helvetica",this.ctx.textAlign="left",this.ctx.textBaseline="top",this.ctx.fillText("score: "+this.allScore,60,20)}}},{key:"main",value:function(){n.update(),n.render(),r=requestAnimationFrame(function(){n.main()})}},{key:"start",value:function(){this.processUserInput(),this.loadImg(),this.player.animation(),this.bullet.useBullet(),this.enemy.createEnemy(),this.main()}}]),t}(),c=function(t,e){return new p(t,e)};y.addEventListener("touchstart",function(){u.style.display="none",i.style.display="block",o.style.display="block";var t=c(i,d);t.start()},!1)}(document,window);